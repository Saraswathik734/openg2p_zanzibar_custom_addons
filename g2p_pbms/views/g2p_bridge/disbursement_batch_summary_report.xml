<?xml version="1.0" encoding="UTF-8"?>
<odoo noupdate="0">
    <record id="action_generate_disbursement_batch_summary" model="ir.actions.report">
        <field name="name">Disbursement Batch Summary</field>
        <field name="model">g2p.disbursement.batch.summary.wizard</field>
        <field name="report_type">qweb-html</field>
        <field name="report_name">g2p_pbms.print_disbursement_batch_summary</field>
        <field name="report_file">g2p_pbms.print_disbursement_batch_summary</field>
        <field name="binding_model_id" ref="g2p_pbms.model_g2p_disbursement_batch_summary_wizard" />
        <field name="binding_type">report</field>
    </record>

    <template id="print_disbursement_batch_summary">
        <t t-call="web.report_layout">
            <t t-call="web.basic_layout">
                <div class="page" style="border: 1px solid black; padding: 20px;">
                    <p style="margin-bottom: -5px;">Date: <span t-esc="time.strftime('%d %b %Y')" /></p>
                    <p>Place: <strong>localhost</strong></p>
                    <div style="margin-bottom: 20px;">
                        <center>
                            <img
                                t-att-src="'/g2p_pbms/static/description/icon.png'"
                                alt="OpenG2P Logo"
                                style="max-height: 100px;"
                            />
                        </center>
                        <h2>
                            <center><strong>Disbursement Batch Summary</strong></center>
                        </h2>
                    </div>
                    <t t-foreach="docs" t-as="doc">
                        <table class="table table-sm" style="width: 100%;">
                            <!-- Batch Details -->
                            <tr>
                                <th colspan="2"><h3>Batch Details</h3></th>
                            </tr>
                            <tr>
                                <td style="width: 50%; text-align: left;"><strong>Batch Control ID:</strong></td>
                                <td style="text-align: left;"><span t-esc="doc.disbursement_batch_control_id" /></td>
                            </tr>
                            <tr>
                                <td style="text-align: left;"><strong>Disbursement Envelope ID:</strong></td>
                                <td style="text-align: left;"><span t-esc="doc.disbursement_envelope_id" /></td>
                            </tr>
                            <tr>
                                <td style="text-align: left;"><strong>Disbursement Cycle Mnemonic:</strong></td>
                                <td style="text-align: left;"><span t-esc="doc.disbursement_cycle_code_mnemonic" /></td>
                            </tr>
                            <tr>
                                <td style="text-align: left;"><strong>Benefit Code Mnemonic:</strong></td>
                                <td style="text-align: left;"><span t-esc="doc.benefit_code_mnemonic" /></td>
                            </tr>

                            <!-- Geo Resolution -->
                            <t t-if="doc.benefit_type != 'CASH_DIGITAL'">
                                <tr>
                                    <th colspan="2"><h3>Geo Resolution</h3></th>
                                </tr>
                                <tr>
                                    <td style="text-align: left;"><strong>Status:</strong></td>
                                    <td style="text-align: left;"><span t-esc="doc.geo_resolution_status" /></td>
                                </tr>
                                <tr>
                                    <td style="text-align: left;"><strong>Timestamp:</strong></td>
                                    <td style="text-align: left;"><span t-esc="doc.geo_resolution_timestamp" /></td>
                                </tr>
                                <tr>
                                    <td style="text-align: left;"><strong>Latest Error Code:</strong></td>
                                    <td style="text-align: left;"><span t-esc="doc.geo_resolution_latest_error_code" /></td>
                                </tr>
                                <tr>
                                    <td style="text-align: left;"><strong>Attempts:</strong></td>
                                    <td style="text-align: left;"><span t-esc="doc.geo_resolution_attempts" /></td>
                                </tr>
                            </t>

                            <!-- Warehouse Allocation -->
                            <t t-if="doc.benefit_type == 'COMMODITY'">
                                <tr>
                                    <th colspan="2"><h3>Warehouse Allocation</h3></th>
                                </tr>
                                <tr>
                                    <td style="text-align: left;"><strong>Status:</strong></td>
                                    <td style="text-align: left;"><span t-esc="doc.warehouse_allocation_status" /></td>
                                </tr>
                                <tr>
                                    <td style="text-align: left;"><strong>Timestamp:</strong></td>
                                    <td style="text-align: left;"><span t-esc="doc.warehouse_allocation_timestamp" /></td>
                                </tr>
                                <tr>
                                    <td style="text-align: left;"><strong>Latest Error Code:</strong></td>
                                    <td style="text-align: left;"><span t-esc="doc.warehouse_allocation_latest_error_code" /></td>
                                </tr>
                                <tr>
                                    <td style="text-align: left;"><strong>Attempts:</strong></td>
                                    <td style="text-align: left;"><span t-esc="doc.warehouse_allocation_attempts" /></td>
                                </tr>
                            </t>

                            <!-- Agency Allocation -->
                            <t t-if="doc.benefit_type != 'CASH_DIGITAL'">
                                <tr>
                                    <th colspan="2"><h3>Agency Allocation</h3></th>
                                </tr>
                                <tr>
                                    <td style="text-align: left;"><strong>Status:</strong></td>
                                    <td style="text-align: left;"><span t-esc="doc.agency_allocation_status" /></td>
                                </tr>
                                <tr>
                                    <td style="text-align: left;"><strong>Timestamp:</strong></td>
                                    <td style="text-align: left;"><span t-esc="doc.agency_allocation_timestamp" /></td>
                                </tr>
                                <tr>
                                    <td style="text-align: left;"><strong>Latest Error Code:</strong></td>
                                    <td style="text-align: left;"><span t-esc="doc.agency_allocation_latest_error_code" /></td>
                                </tr>
                                <tr>
                                    <td style="text-align: left;"><strong>Attempts:</strong></td>
                                    <td style="text-align: left;"><span t-esc="doc.agency_allocation_attempts" /></td>
                                </tr>
                            </t>

                            <!-- FA Resolution -->
                            <t t-if="doc.benefit_type == 'CASH_DIGITAL'">
                                <tr>
                                    <th colspan="2"><h3>FA Resolution</h3></th>
                                </tr>
                                <tr>
                                    <td style="text-align: left;"><strong>Status:</strong></td>
                                    <td style="text-align: left;"><span t-esc="doc.fa_resolution_status" /></td>
                                </tr>
                                <tr>
                                    <td style="text-align: left;"><strong>Timestamp:</strong></td>
                                    <td style="text-align: left;"><span t-esc="doc.fa_resolution_timestamp" /></td>
                                </tr>
                                <tr>
                                    <td style="text-align: left;"><strong>Latest Error Code:</strong></td>
                                    <td style="text-align: left;"><span t-esc="doc.fa_resolution_latest_error_code" /></td>
                                </tr>
                                <tr>
                                    <td style="text-align: left;"><strong>Attempts:</strong></td>
                                    <td style="text-align: left;"><span t-esc="doc.fa_resolution_attempts" /></td>
                                </tr>
                            </t>

                            <!-- Sponsor Bank Dispatch -->
                            <t t-if="doc.benefit_type == 'CASH_DIGITAL' or doc.benefit_type == 'CASH_PHYSICAL'">
                                <tr>
                                    <th colspan="2"><h3>Sponsor Bank Dispatch</h3></th>
                                </tr>
                                <tr>
                                    <td style="text-align: left;"><strong>Status:</strong></td>
                                    <td style="text-align: left;"><span t-esc="doc.sponsor_bank_dispatch_status" /></td>
                                </tr>
                                <tr>
                                    <td style="text-align: left;"><strong>Timestamp:</strong></td>
                                    <td style="text-align: left;"><span t-esc="doc.sponsor_bank_dispatch_timestamp" /></td>
                                </tr>
                                <tr>
                                    <td style="text-align: left;"><strong>Latest Error Code:</strong></td>
                                    <td style="text-align: left;"><span t-esc="doc.sponsor_bank_dispatch_latest_error_code" /></td>
                                </tr>
                                <tr>
                                    <td style="text-align: left;"><strong>Attempts:</strong></td>
                                    <td style="text-align: left;"><span t-esc="doc.sponsor_bank_dispatch_attempts" /></td>
                                </tr>
                            </t>

                        </table>

                        <!-- Related Geos Table -->
                        <t t-if="doc.benefit_type != 'CASH_DIGITAL'">
                            <h3 style="margin-top: 30px;">Related Geos</h3>
                            <table class="table table-bordered" style="width: 100%;">
                                <thead>
                                    <tr>
                                    <!-- TODO: remove: ids, warehouse and agency attributes (ADD MEASUREMENT UNITS)-->
                                        <th>Large Zone Mnemonic</th>
                                        <th>Small Zone Mnemonic</th>
                                        <th>No. of Beneficiaries</th>
                                        <th>Total Quantity</th>
                                        <t t-if="doc.benefit_type != 'CASH_PHYSICAL'">
                                            <th>Warehouse</th>
                                            <th>Warehouse Notified</th>
                                        </t>
                                        <th>Agency</th>
                                        <th>Agency Notified</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <t t-foreach="doc.disbursement_batch_summary_geo_ids" t-as="geo">
                                        <tr>
                                            <td><span t-esc="geo.administrative_zone_mnemonic_large" /></td>
                                            <td><span t-esc="geo.administrative_zone_mnemonic_small" /></td>
                                            <td><span t-esc="geo.no_of_beneficiaries" /></td>
                                            <td><span t-esc="geo.total_quantity" /></td>
                                            <t t-if="doc.benefit_type != 'CASH_PHYSICAL'">
                                                <td><span t-esc="geo.warehouse_mnemonic" /></td>
                                                <td><span t-esc="geo.warehouse_notification_status" /></td>
                                            </t>
                                            <td><span t-esc="geo.agency_mnemonic" /></td>
                                            <td><span t-esc="geo.agency_notification_status" /></td>
                                        </tr>
                                    </t>
                                </tbody>
                            </table>
                        </t>
                    </t>
                </div>
            </t>
        </t>
    </template>
</odoo>